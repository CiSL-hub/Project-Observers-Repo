<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Obsidian Graph</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #0f0f14;
    }
    #graph {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="graph"></div>

  <script src="https://unpkg.com/force-graph"></script>
  <script>
    const container = document.getElementById("graph");

    fetch("./graph.json")
      .then(res => res.json())
      .then(data => {
        const graph = ForceGraph()(container)
          .graphData(data)

          /* ===== NODES ===== */
          .nodeId("id")
          .nodeLabel("label")
          .nodeRelSize(6)
          .nodeAutoColorBy(d => d.id.split("/")[0])

          /* ===== LINKS ===== */
          .linkWidth(1)
          .linkColor(() => "rgba(180,180,200,0.4)")

          /* ===== PHYSICS (STABLE) ===== */
          .d3VelocityDecay(0.4)
          .d3Force("charge").strength(-180)
          .d3Force("link").distance(70).strength(0.6)
          .cooldownTicks(200)
          .cooldownTime(15000)

          /* ===== DRAG BEHAVIOR ===== */
          .onNodeDrag(node => {
            node.fx = node.x;
            node.fy = node.y;
          })
          .onNodeDragEnd(node => {
            node.fx = null;
            node.fy = null;
          })

          /* ===== CLICK NAVIGATION ===== */
          .onNodeClick(node => {
            const cleanPath = encodeURI(
              "/" + node.id.replace(/\.md$/, "")
            );
            window.location.href = cleanPath;
          })

          /* ===== CAMERA ===== */
          .zoomToFit(400, 80);

        /* Resize safety */
        window.addEventListener("resize", () => {
          graph.width(container.clientWidth);
          graph.height(container.clientHeight);
        });
      });
  </script>
</body>
</html>
